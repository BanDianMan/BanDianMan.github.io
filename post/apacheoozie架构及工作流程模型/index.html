<!doctype html>
<html lang="en-us">
  <head>
    <title>ApacheOozie架构及工作流程模型 // HejhBlogs</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.69.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="He Jia Hao" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://BanDianMan.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ApacheOozie架构及工作流程模型"/>
<meta name="twitter:description" content="Apache Oozie架构及工作流程模型 一 Oozie概述 1 Oozie是什么  Hadoop的工作流运行引擎和调度程序  MapReduce作业 Spark（Streaming）作业 Hive 作业   Apache顶级项目  打包主要在Hadoop发行版中 http://oozie.apache.org/docs/4.2.0/index.htm   提供工作流管理与协调器 管理Actions的有向无环图（DAG）  2 Oozie架构  运行HTTP服务  Clients通过提交workflows与服务进行交互 工作流程立即执行或以后执行   通过XML定义工作流程  无需编写实现工具接口和扩展Configured类的Java代码   四种访问Oozie的方式  CML Java API Rest API Web UI    3 Oozie组件  工作流定义：这些被表示为有向非循环图（DAG），以指定要执行的动作序列  workflow.xml   Property file：用于workflow的参数  job.properties   库：在lib文件夹中（可选） 协调器：调度程序（可选）  coordinator.xml   捆绑包：协调程序和工作流程的包（可选）  3."/>

    <meta property="og:title" content="ApacheOozie架构及工作流程模型" />
<meta property="og:description" content="Apache Oozie架构及工作流程模型 一 Oozie概述 1 Oozie是什么  Hadoop的工作流运行引擎和调度程序  MapReduce作业 Spark（Streaming）作业 Hive 作业   Apache顶级项目  打包主要在Hadoop发行版中 http://oozie.apache.org/docs/4.2.0/index.htm   提供工作流管理与协调器 管理Actions的有向无环图（DAG）  2 Oozie架构  运行HTTP服务  Clients通过提交workflows与服务进行交互 工作流程立即执行或以后执行   通过XML定义工作流程  无需编写实现工具接口和扩展Configured类的Java代码   四种访问Oozie的方式  CML Java API Rest API Web UI    3 Oozie组件  工作流定义：这些被表示为有向非循环图（DAG），以指定要执行的动作序列  workflow.xml   Property file：用于workflow的参数  job.properties   库：在lib文件夹中（可选） 协调器：调度程序（可选）  coordinator.xml   捆绑包：协调程序和工作流程的包（可选）  3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://BanDianMan.github.io/post/apacheoozie%E6%9E%B6%E6%9E%84%E5%8F%8A%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E6%A8%A1%E5%9E%8B/" />
<meta property="article:published_time" content="2020-05-07T10:57:14+08:00" />
<meta property="article:modified_time" content="2020-05-07T10:57:14+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://BanDianMan.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="He Jia Hao" /></a>
      <h1>HejhBlogs</h1>
      <p>晚来天欲雪，能饮一杯无？</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/BanDianMan/BanDianMan.github.io" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">ApacheOozie架构及工作流程模型</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          May 7, 2020
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          5 min read
        </div></div>
    </header>
    <div class="post-content">
      <h1 id="apache-oozie架构及工作流程模型">Apache Oozie架构及工作流程模型</h1>
<h2 id="一-oozie概述">一 Oozie概述</h2>
<h3 id="1-oozie是什么">1 Oozie是什么</h3>
<ul>
<li>Hadoop的工作流运行引擎和调度程序
<ul>
<li>MapReduce作业</li>
<li>Spark（Streaming）作业</li>
<li>Hive 作业</li>
</ul>
</li>
<li>Apache顶级项目
<ul>
<li>打包主要在Hadoop发行版中</li>
<li><a href="http://oozie.apache.org/docs/4.2.0/index.htm">http://oozie.apache.org/docs/4.2.0/index.htm</a></li>
</ul>
</li>
<li>提供工作流管理与协调器</li>
<li>管理Actions的有向无环图（DAG）</li>
</ul>
<h3 id="2-oozie架构">2 Oozie架构</h3>
<p><img src="https://i.loli.net/2020/05/07/Bo9HtzRrIeWjC26.png" alt="image-20200507105750081"></p>
<ul>
<li>运行HTTP服务
<ul>
<li>Clients通过提交workflows与服务进行交互</li>
<li>工作流程立即执行或以后执行</li>
</ul>
</li>
<li>通过XML定义工作流程
<ul>
<li>无需编写实现工具接口和扩展Configured类的Java代码</li>
</ul>
</li>
<li>四种访问Oozie的方式
<ul>
<li>CML</li>
<li>Java API</li>
<li>Rest API</li>
<li>Web UI</li>
</ul>
</li>
</ul>
<h3 id="3-oozie组件">3 Oozie组件</h3>
<ul>
<li>工作流定义：这些被表示为有向非循环图（DAG），以指定要执行的动作序列
<ul>
<li>workflow.xml</li>
</ul>
</li>
<li>Property file：用于workflow的参数
<ul>
<li>job.properties</li>
</ul>
</li>
<li>库：在lib文件夹中（可选）</li>
<li>协调器：调度程序（可选）
<ul>
<li>coordinator.xml</li>
</ul>
</li>
<li>捆绑包：协调程序和工作流程的包（可选）</li>
</ul>
<h4 id="31-组件之间的关系">3.1 组件之间的关系</h4>
<ul>
<li>一个bundle job可以可以对应多个协调器作业</li>
<li>一个协调器作业可以对应多个workflow作业</li>
<li>一个workflow作业可以对应多个actions</li>
<li>一个workflow流程可以有零个或多个子workflow</li>
</ul>
<h4 id="32-view层中的oozie组件">3.2 view层中的Oozie组件</h4>
<p><img src="https://i.loli.net/2020/05/07/qavrLNnTEpG8YDO.png" alt="image-20200507105808165"></p>
<h3 id="4-oozie优缺点">4 Oozie优缺点</h3>
<h4 id="41-oozie优点">4.1 Oozie优点</h4>
<ul>
<li>强大的社区支持</li>
<li>与HUE，Cloudera Manager，Apache Ambari集成</li>
<li>HCatalog集成</li>
<li>SLA警报（Oozie 4中的新增功能）
<ul>
<li>Workflow, Action 等级</li>
</ul>
</li>
<li>生态系统支持：M/R，Hive，Spark，Sqoop，Java等</li>
<li>非常详细的文档</li>
<li>启动器作业作为map tasks</li>
</ul>
<h4 id="42-oozie-缺点">4.2 Oozie 缺点</h4>
<ul>
<li>启动器作业作为map tasks</li>
<li>UI界面不友好—但是HUE，oozie-web（和良好的API）可以补充</li>
<li>令人困惑的对象模型（bundles, coordinators, workflows）</li>
<li>安装困难—extjs, hadoop proxy user, RDBMS</li>
<li>XML！</li>
</ul>
<h2 id="二-oozie-workflow">二 Oozie Workflow</h2>
<ul>
<li>
<p>一个工作流由Action节点和Control节点组成</p>
<ul>
<li>Action节点：执行工作流程的任务</li>
<li>Control节点：管理工作流程执行</li>
</ul>
<p><img src="https://i.loli.net/2020/05/07/ubsIq9A46lrfBeG.png" alt="image-20200507105821028"></p>
</li>
</ul>
<h3 id="1-workflow定义">1 Workflow定义</h3>
<p><img src="https://i.loli.net/2020/05/07/3QxplfmXKbyuHBe.png" alt="image-20200507105825645"></p>
<h3 id="2-workflow-actions概述">2 Workflow Actions概述</h3>
<ul>
<li>Oozie Workflow Actions是异步的
<ul>
<li>Work工作流操作中的任务是异步执行的</li>
<li>flow工作流程会等到所有操作完成后再过渡到下一个节点</li>
<li>fs action 是一个例外，它被视为同步操作</li>
</ul>
</li>
<li>Actions具有两个转换：OK 或 Error</li>
<li>动作恢复
<ul>
<li>如果action已经开始，则不会触发任何重试</li>
<li>如果故障是短暂错误，例如网络错误，Oozie将在预定时间间隔后重试采取的行动；</li>
<li>如果不是临时错误而导致失败，Ozzie将中止工作流程作业，此后将需要人工干预</li>
</ul>
</li>
</ul>
<h3 id="3-actions">3 Actions</h3>
<h4 id="31-mapreduce-action">3.1 MapReduce Action</h4>
<p>在应用程序目录中包含.jar文件的目录应命名为lib</p>
<p><img src="https://i.loli.net/2020/05/07/9lU7BKmayNHjepf.png" alt="image-20200507105833174"></p>
<h4 id="32-fs-hdfs-action">3.2 FS (HDFS) Action</h4>
<ul>
<li>fs操作允许在HDFS中操作文件和目录：移动，删除，mkdir，chmod，touchz和chgrp</li>
<li>FS命令是从FS Action中同步执行的，工作流作业将等待直到指定的文件命令完成后再继续执行下一个操作</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;workflow-app</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;sample-wf&#34;</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;uri:oozie:workflow:0.5&#34;</span><span style="color:#f92672">&gt;</span>
...
<span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;hdfscommands&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;fs&gt;</span>
<span style="color:#f92672">&lt;delete</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#39;hdfs://foo:8020/usr/tucu/temp-data&#39;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;mkdir</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#39;archives/${wf:id()}&#39;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;move</span> <span style="color:#a6e22e">source=</span><span style="color:#e6db74">&#39;${jobInput}&#39;</span> <span style="color:#a6e22e">target=</span><span style="color:#e6db74">&#39;archives/${wf:id()}/processed-input&#39;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;chmod</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#39;${jobOutput}&#39;</span> <span style="color:#a6e22e">permissions=</span><span style="color:#e6db74">&#39;-rwxrw-rw-&#39;</span> <span style="color:#a6e22e">dir-files=</span><span style="color:#e6db74">&#39;true&#39;</span><span style="color:#f92672">&gt;&lt;recursive/&gt;&lt;/chmod&gt;</span>
<span style="color:#f92672">&lt;chgrp</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#39;${jobOutput}&#39;</span> <span style="color:#a6e22e">group=</span><span style="color:#e6db74">&#39;testgroup&#39;</span> <span style="color:#a6e22e">dir-files=</span><span style="color:#e6db74">&#39;true&#39;</span><span style="color:#f92672">&gt;&lt;recursive/&gt;&lt;/chgrp&gt;</span>
<span style="color:#f92672">&lt;/fs&gt;</span>
<span style="color:#f92672">&lt;ok</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;myotherjob&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;error</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;errorcleanup&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/action&gt;</span>
...
<span style="color:#f92672">&lt;/workflow-app&gt;</span>
</code></pre></div><h4 id="33-java-action">3.3 Java Action</h4>
<p><img src="https://i.loli.net/2020/05/07/pRKfyhWSZQz4en8.png" alt="image-20200507105846645"></p>
<ul>
<li>Java操作将执行指定的主Java类的 public static void main（String [] args）方法</li>
<li>Java应用程序在Hadoop集群中作为map-reduce任务与单个Mapper任务一起执行</li>
</ul>
<h4 id="34-shell-action">3.4 Shell Action</h4>
<p><img src="https://i.loli.net/2020/05/07/pdzhNrlGbgA9oyT.png" alt="image-20200507105851921"></p>
<ul>
<li>该动作将执行shell命令</li>
<li>输出可以限制为2k</li>
</ul>
<h4 id="35-hive-action">3.5 Hive Action</h4>
<h5 id="351-script">3.5.1 script</h5>
<p><img src="https://i.loli.net/2020/05/07/2bwUT6SOJNP38mg.png" alt="image-20200507105857541"></p>
<ul>
<li>Script：一个element，其中包含要运行的Hive脚本的名称和相对于工作流目录的路径。 Hive脚本与应用程序打包在工作流目录下。</li>
<li>Query：v0.6中的支持</li>
</ul>
<h5 id="352-jdbc">3.5.2 jdbc</h5>
<p><img src="https://i.loli.net/2020/05/07/5EZjIPtmVby84HB.png" alt="image-20200507105902371"></p>
<ul>
<li>Jdbc-url：JDBC用户名，用于提供对JDBC驱动程序的远程访问</li>
</ul>
<h4 id="36-discp-action">3.6 DISCP Action</h4>
<p><img src="https://i.loli.net/2020/05/07/dKSg49oAxmJ6P2D.png" alt="image-20200507105909415"></p>
<ul>
<li>arg：disp命令的参数
<ul>
<li>-update：用于从源复制目标上不存在或与目标版本不同的文件</li>
<li>-skipcrccheck：是否在源路径和目标路径之间跳过CRC检查</li>
</ul>
</li>
</ul>
<h4 id="37-spark-action">3.7 Spark Action</h4>
<p><img src="https://i.loli.net/2020/05/07/3XDfQo9IhJORrz8.png" alt="image-20200507105915146"></p>
<h4 id="38-sub-workflow-action">3.8 Sub-Workflow Action</h4>
<p>子工作流程作业与父工作流程作业的在同一Oozie系统实例中运行</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;workflow-app</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;sample-wf&#34;</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;uri:oozie:workflow:0.1&#34;</span><span style="color:#f92672">&gt;</span>
...
<span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;sub-workflow&gt;</span>
<span style="color:#f92672">&lt;app-path&gt;</span>child-wf<span style="color:#f92672">&lt;/app-path&gt;</span>
<span style="color:#f92672">&lt;configuration&gt;</span>
<span style="color:#f92672">&lt;property&gt;</span>
<span style="color:#f92672">&lt;name&gt;</span>input.dir<span style="color:#f92672">&lt;/name&gt;</span>
<span style="color:#f92672">&lt;value&gt;</span>${wf:id()}/second-mr-output<span style="color:#f92672">&lt;/value&gt;</span>
<span style="color:#f92672">&lt;/property&gt;</span>
<span style="color:#f92672">&lt;/configuration&gt;</span>
<span style="color:#f92672">&lt;/sub-workflow&gt;</span>
<span style="color:#f92672">&lt;ok</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;end&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;error</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;kill&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/action&gt;</span>
...
<span style="color:#f92672">&lt;/workflow-app&gt;</span>
</code></pre></div><h3 id="4-workflow状态转换">4 Workflow状态转换</h3>
<p><img src="https://i.loli.net/2020/05/07/EsHITXyjSzlF4dn.png" alt="image-20200507105926109"></p>
<h4 id="41-start-end-kill">4.1 Start, End, Kill</h4>
<h5 id="411-start-control-node">4.1.1 Start Control Node</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;workflow-app</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;[WF-DEF-NAME]&#34;</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;uri:oozie:workflow:0.1&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;start</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;[NODE-NAME]&#34;</span><span style="color:#f92672">/&gt;</span>
...
<span style="color:#f92672">&lt;/workflow-app&gt;</span>
</code></pre></div><h5 id="412-end-control-node">4.1.2 End Control Node</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;workflow-app</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;[WF-DEF-NAME]&#34;</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;uri:oozie:workflow:0.1&#34;</span><span style="color:#f92672">&gt;</span>
...
<span style="color:#f92672">&lt;end</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;[NODE-NAME]&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/workflow-app&gt;</span>
</code></pre></div><h5 id="413-kill-control-node">4.1.3 Kill Control Node</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;workflow-app</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;foo-wf&#34;</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;uri:oozie:workflow:0.1&#34;</span><span style="color:#f92672">&gt;</span>
...
<span style="color:#f92672">&lt;kill</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;killBecauseNoInput&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;message&gt;</span>Input unavailable<span style="color:#f92672">&lt;/message&gt;</span>
<span style="color:#f92672">&lt;/kill&gt;</span>
...
<span style="color:#f92672">&lt;/workflow-app&gt;</span>
</code></pre></div><h4 id="42-decision">4.2 Decision</h4>
<p><img src="https://i.loli.net/2020/05/07/7EUCzj3MLBiZ6bn.png" alt="image-20200507105934642"></p>
<h4 id="43-fork--join">4.3 Fork &amp; Join</h4>
<p><img src="https://i.loli.net/2020/05/07/5KYcGjIMxkniWTV.png" alt="image-20200507105939198"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;fork</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;forking&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;path</span> <span style="color:#a6e22e">start=</span><span style="color:#e6db74">&#34;mrjob&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;path</span> <span style="color:#a6e22e">start=</span><span style="color:#e6db74">&#34;hivejob&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/fork&gt;</span>
<span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;mrjob&#34;</span><span style="color:#f92672">&gt;</span>
…
<span style="color:#f92672">&lt;ok</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;joining&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;error</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;kill&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/action&gt;</span>
<span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;hivejob&#34;</span><span style="color:#f92672">&gt;</span>
…
<span style="color:#f92672">&lt;ok</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;joining&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;error</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;kill&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/action&gt;</span>
<span style="color:#f92672">&lt;join</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;joining&#34;</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;nextaction&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><h3 id="5-workflow应用程序的部署和执行">5 Workflow应用程序的部署和执行</h3>
<ol>
<li>
<p>应用程序文件夹位于HDFS中</p>
</li>
<li>
<p>必须定义工作流程定义在 workflow.xml中</p>
</li>
<li>
<p>任何库都必须存储在lib子文件夹中</p>
</li>
<li>
<p>job.properties</p>
<pre><code class="language-properties" data-lang="properties">nameNode=hdfs://sandbox.hortonworks.com:8020
jobTracker=sandbox.hortonworks.com:8050
queueName=default
oozie.wf.application.path=${nameNode}/application-folder
oozie.use.system.libpath=true
oozie.libpath=${nameNode}/user/oozie/share/lib
</code></pre></li>
<li>
<p>执行</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">oozie job --oozie http://sandbox.hortonworks.com:11000/oozie -config job.properties -run
</code></pre></div></li>
</ol>
<h2 id="三-oozie协调器作业调度">三 Oozie协调器–作业调度</h2>
<p>Oozie根据以下内容执行工作流程作业</p>
<ul>
<li>时间依赖性/频率</li>
<li>数据依赖</li>
</ul>
<p><img src="https://i.loli.net/2020/05/07/Jf4nFsimWaMIV3E.png" alt="image-20200507105945937"></p>
<h3 id="1-协调器定义概述">1 协调器定义概述</h3>
<p><img src="https://i.loli.net/2020/05/07/M19izVwgEP2QkWj.png" alt="image-20200507105950529"></p>
<h3 id="2-coordinator-details">2 Coordinator Details</h3>
<p><img src="https://i.loli.net/2020/05/07/uHJd5oFybXa2VlS.png" alt="image-20200507105954829"></p>
<h3 id="3-定义">3 定义</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;coordinator-app</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;[NAME]&#34;</span>
<span style="color:#a6e22e">frequency=</span><span style="color:#e6db74">&#34;[FREQUENCY]&#34;</span> <span style="color:#a6e22e">start=</span><span style="color:#e6db74">&#34;[DATETIME]&#34;</span> <span style="color:#a6e22e">end=</span><span style="color:#e6db74">&#34;[DATETIME]&#34;</span> <span style="color:#a6e22e">timezone=</span><span style="color:#e6db74">&#34;[TIMEZONE]&#34;</span>
<span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;uri:oozie:coordinator:0.1&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#75715e">&lt;!-- … --&gt;</span>
<span style="color:#f92672">&lt;/coordinator-app&gt;</span>

</code></pre></div><ul>
<li>start：作业的开始时间</li>
<li>end：作业的结束日期时间</li>
<li>timezone：协调器应用程序的时区。</li>
<li>frequency：以分钟为单位的actions频率</li>
</ul>
<h3 id="4-controls">4 Controls</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;controls&gt;</span>
<span style="color:#f92672">&lt;timeout&gt;</span>[TIME_PERIOD]<span style="color:#f92672">&lt;/timeout&gt;</span>
<span style="color:#f92672">&lt;concurrency&gt;</span>[CONCURRENCY]<span style="color:#f92672">&lt;/concurrency&gt;</span>
<span style="color:#f92672">&lt;execution&gt;</span>[EXECUTION_STRATEGY]<span style="color:#f92672">&lt;/execution&gt;</span>
<span style="color:#f92672">&lt;/controls&gt;</span>

</code></pre></div><ul>
<li>timeout：实例化操作将等待其他条件以分钟为单位的最长时间</li>
<li>concurrency：并发运行的实例的最大数量</li>
<li>execution：指定执行顺序：
<ul>
<li>FIFO（最旧的优先）默认值</li>
<li>LIFO（最新的优先）</li>
<li>ONLYLAST（只有最后的）</li>
</ul>
</li>
</ul>
<h3 id="5-datasets">5 Datasets</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;datasets&gt;</span>
<span style="color:#f92672">&lt;dataset</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;logs&#34;</span> <span style="color:#a6e22e">frequency=</span><span style="color:#e6db74">&#34;${coord:days(1)}&#34;</span>
<span style="color:#a6e22e">initial-instance=</span><span style="color:#e6db74">&#34;2009-01-02T08:00Z&#34;</span> <span style="color:#a6e22e">timezone=</span><span style="color:#e6db74">&#34;America/Los_Angeles&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;uri-template&gt;</span>hdfs://bar:9000/app/logs/${YEAR}${MONTH}/${DAY}/data<span style="color:#f92672">&lt;/uri-template&gt;</span>
<span style="color:#f92672">&lt;done-flag&gt;&lt;/done-flag&gt;</span>
<span style="color:#f92672">&lt;/dataset&gt;</span>
<span style="color:#f92672">&lt;dataset</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">“feeds&#34;</span> <span style="color:#a6e22e">frequency=</span><span style="color:#e6db74">&#34;${coord:days(1)}&#34;</span>
<span style="color:#a6e22e">initial-instance=</span><span style="color:#e6db74">&#34;2009-01-02T08:00Z&#34;</span> <span style="color:#a6e22e">timezone=</span><span style="color:#e6db74">&#34;America/Los_Angeles&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;uri-template&gt;</span>hdfs://bar:9000/app/stats/${YEAR}/${MONTH}/${DAY}/data<span style="color:#f92672">&lt;/uri-template&gt;</span>
<span style="color:#f92672">&lt;/dataset&gt;</span>
<span style="color:#f92672">&lt;/datasets&gt;</span>

</code></pre></div><ul>
<li>数据集协调器应用程序使用</li>
<li>完成标志
<ul>
<li>如果未指定，oozie将检查文件夹中的_SUCCESS文件</li>
<li>如果设置为空，则oozie检查文件夹是否存在</li>
<li>如果设置了文件名，请检查文件夹中文件是否存在</li>
</ul>
</li>
</ul>
<h3 id="6-input-events">6 Input-Events</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;input-events&gt;</span>
<span style="color:#f92672">&lt;data-in</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;[NAME]&#34;</span> <span style="color:#a6e22e">dataset=</span><span style="color:#e6db74">&#34;[DATASET]&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;instance&gt;</span>[INSTANCE]<span style="color:#f92672">&lt;/instance&gt;</span> ...
<span style="color:#f92672">&lt;/data-in&gt;</span>
<span style="color:#f92672">&lt;data-in</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;[NAME]&#34;</span> <span style="color:#a6e22e">dataset=</span><span style="color:#e6db74">&#34;[DATASET]&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;start-instance&gt;</span>[INSTANCE]<span style="color:#f92672">&lt;/start-instance&gt;</span>
<span style="color:#f92672">&lt;end-instance&gt;</span>[INSTANCE]<span style="color:#f92672">&lt;/end-instance&gt;</span>
<span style="color:#f92672">&lt;/data-in&gt;</span>
<span style="color:#f92672">&lt;/input-events&gt;</span>

</code></pre></div><ul>
<li>input-events：协调器作业输入事件</li>
<li>data-in：定义一个可以解析为一个或多个实例数据集的作业输入条件</li>
</ul>
<h3 id="7-output-events">7 Output-Events</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;output-events&gt;</span>
<span style="color:#f92672">&lt;data-out</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;[NAME]&#34;</span> <span style="color:#a6e22e">dataset=</span><span style="color:#e6db74">&#34;[DATASET]&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;instance&gt;</span>[INSTANCE]<span style="color:#f92672">&lt;/instance&gt;</span> <span style="color:#f92672">&lt;/data-out&gt;</span>
<span style="color:#f92672">&lt;/output-events&gt;</span>

</code></pre></div><ul>
<li>input-events: 协调器作业输出事件</li>
<li>data-in: 定义一个可以解析为一个或多个实例数据集的作业输出</li>
</ul>
<h3 id="8-协调器通用el功能">8 协调器通用EL功能</h3>
<p>数据集频率：使用下面的计划或按时间表计划</p>
<p><img src="https://i.loli.net/2020/05/07/KotgdOSc48G97fn.png" alt="image-20200507110004736"></p>
<p>数据集事件时间：</p>
<ul>
<li>${coord：current（int n）}表示n x数据集实例频率偏移</li>
<li>${coord：offset（int n，String timeUnit）}表示n个时间单位的频偏</li>
<li>$ {coord：latest（int n）}表示第n个最新的当前可用实例</li>
</ul>
<h3 id="9-data-pipeline">9 Data Pipeline</h3>
<p>具有两个协调器应用程序的数据管道</p>
<ul>
<li>计划每小时运行一次</li>
<li>另一个计划每天运行</li>
</ul>
<p><img src="https://i.loli.net/2020/05/07/cfLjohE2gMY5Vba.png" alt="image-20200507110009578"></p>
<h3 id="10-协调器应用程序部署和执行">10 协调器应用程序：部署和执行</h3>
<ol>
<li>
<p>协调器文件夹位于HDFS中</p>
</li>
<li>
<p>协调器必须定义在coordinator.xml中</p>
</li>
<li>
<p>任何库都必须存储在lib子文件夹中</p>
</li>
</ol>
<p><img src="https://i.loli.net/2020/05/07/bS1N9hnPcW6Xdoj.png" alt="image-20200507110014926"></p>
<ol start="4">
<li>
<p>相关的工作流程应该已经定义并部署</p>
</li>
<li>
<p>执行</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">oozie job --oozie http://sandbox.hortonworks.com:11000/oozie -config job.properties -run
   
</code></pre></div></li>
</ol>
<h2 id="四-oozie捆绑包">四 Oozie捆绑包</h2>
<h3 id="1-bundle概述">1 Bundle概述</h3>
<ul>
<li>
<p><strong>Oozie Bundle system</strong>允许用户定义和执行一堆通常称为数据管道的协调器应用程序。捆绑软件中的协调器应用程序之间没有明确的依赖关系。 但是，用户可以使用协调程序应用程序的数据依赖性来创建隐式数据应用程序管道</p>
</li>
<li>
<p>用户将能够在捆绑软件级别中启动/停止/暂停/继续/重新运行，从而实现更好，更轻松的操作控制</p>
</li>
<li>
<p>在协调器顶部的新抽象层</p>
</li>
<li>
<p>用户可以定义和执行一系列协调器应用程序</p>
</li>
<li>
<p>捆绑包是可选的</p>
</li>
</ul>
<p><img src="upload%5Cimage-20200507110021371.png" alt="image-20200507110021371"></p>
<h3 id="2-bundle定义">2 Bundle定义</h3>
<p><img src="https://i.loli.net/2020/05/07/iPvsSBZ7CENdMx2.png" alt="image-20200507110025967"></p>
<h2 id="五-oozie常用命令">五 Oozie常用命令</h2>
<ul>
<li>oozie version</li>
<li>oozie job –info</li>
<li>oozie job –kill</li>
<li>oozie job –log</li>
<li>oozie job –run|submit|start</li>
<li>oozie admin –status</li>
<li>oozie validate workflow.xml</li>
</ul>
<h2 id="六-oozie安装">六 Oozie安装</h2>
<h3 id="1-上传和解压">1 上传和解压</h3>
<p>下载oozie和ext-2.2.zip，上传至/software下，解压至/opt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># tar zxvf oozie-4.1.0-cdh5.14.2.tar.gz -C /opt/</span>

</code></pre></div><h3 id="2-配置环境变量">2 配置环境变量</h3>
<p>编辑环境变量</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># vi /etc/profile</span>
------------------------------------
<span style="color:#75715e"># oozie</span>
export OOZIE_HOME<span style="color:#f92672">=</span>/opt/oozie-4.1.0-cdh5.14.2
export PATH<span style="color:#f92672">=</span>$OOZIE_HOME/bin:$PATH

</code></pre></div><p>刷新环境变量</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># source /etc/profile</span>

</code></pre></div><h3 id="3-数据库中建表">3 数据库中建表</h3>
<p>这里提到的数据库是关系型数据库，用来存储Oozie的数据。Oozie自带一个Derby，不过Derby只能拿来实验的，这里我选择mysql作为Oozie的数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql <span style="color:#f92672">-</span>uroot <span style="color:#f92672">-</span>proot

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> oozie;
mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;oozie&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;oozie&#39;</span>;
mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> oozie.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;oozie&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;oozie&#39;</span> <span style="color:#66d9ef">with</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">option</span>;
mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">privileges</span> <span style="color:#66d9ef">on</span> oozie.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;oozie&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> identified <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;oozie&#39;</span> <span style="color:#66d9ef">with</span> <span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">option</span>;
mysql<span style="color:#f92672">&gt;</span> flush <span style="color:#66d9ef">privileges</span>;

</code></pre></div><h3 id="4-编辑配置文件">4 编辑配置文件</h3>
<p>编辑 oozie-site.xml 配置mysql的连接属性</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># cd /opt/oozie-4.1.0-cdh5.14.2/conf/</span>
<span style="color:#75715e"># cp oozie-site.xml oozie-site.xml.bak</span>
<span style="color:#75715e"># vi oozie-site.xml</span>

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
<span style="color:#f92672">&lt;configuration&gt;</span>
    <span style="color:#f92672">&lt;property&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>oozie.services<span style="color:#f92672">&lt;/name&gt;</span> 
		<span style="color:#f92672">&lt;value&gt;</span>
			org.apache.oozie.service.SchedulerService,
            org.apache.oozie.service.InstrumentationService,
            org.apache.oozie.service.MemoryLocksService,
            org.apache.oozie.service.UUIDService,
            org.apache.oozie.service.ELService,
            org.apache.oozie.service.AuthorizationService,
            org.apache.oozie.service.UserGroupInformationService,
            org.apache.oozie.service.HadoopAccessorService,
            org.apache.oozie.service.JobsConcurrencyService,
            org.apache.oozie.service.URIHandlerService,
            org.apache.oozie.service.DagXLogInfoService,
            org.apache.oozie.service.SchemaService,
            org.apache.oozie.service.LiteWorkflowAppService,
            org.apache.oozie.service.JPAService,
            org.apache.oozie.service.StoreService,
            org.apache.oozie.service.SLAStoreService,
            org.apache.oozie.service.DBLiteWorkflowStoreService,
            org.apache.oozie.service.CallbackService,
            org.apache.oozie.service.ActionService,
            org.apache.oozie.service.ShareLibService,
            org.apache.oozie.service.CallableQueueService,
            org.apache.oozie.service.ActionCheckerService,
            org.apache.oozie.service.RecoveryService,
            org.apache.oozie.service.PurgeService,
            org.apache.oozie.service.CoordinatorEngineService,
            org.apache.oozie.service.BundleEngineService,
            org.apache.oozie.service.DagEngineService,
            org.apache.oozie.service.CoordMaterializeTriggerService,
            org.apache.oozie.service.StatusTransitService,
            org.apache.oozie.service.PauseTransitService,
            org.apache.oozie.service.GroupsService,
            org.apache.oozie.service.ProxyUserService,
            org.apache.oozie.service.XLogStreamingService,
            org.apache.oozie.service.JvmPauseMonitorService,
            org.apache.oozie.service.SparkConfigurationService
		<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/property&gt;</span>
	<span style="color:#f92672">&lt;property&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>oozie.service.HadoopAccessorService.hadoop.configurations<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>*=/opt/hadoop-2.6.0-cdh5.14.2/etc/hadoop<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/property&gt;</span>
	<span style="color:#f92672">&lt;property&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>oozie.service.JPAService.create.db.schema<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>true<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/property&gt;</span>
	<span style="color:#f92672">&lt;property&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>oozie.service.JPAService.jdbc.driver<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>com.mysql.jdbc.Driver<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/property&gt;</span>
	<span style="color:#f92672">&lt;property&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>oozie.service.JPAService.jdbc.url<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>jdbc:mysql://singleNode:3306/oozie?createDatabaseIfNotExist=true<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/property&gt;</span>
	<span style="color:#f92672">&lt;property&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>oozie.service.JPAService.jdbc.username<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>oozie<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/property&gt;</span>
	<span style="color:#f92672">&lt;property&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>oozie.service.JPAService.jdbc.password<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>oozie<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/property&gt;</span>
	<span style="color:#f92672">&lt;property&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>oozie.processing.timezone<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>GMT+0800<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/property&gt;</span>
<span style="color:#f92672">&lt;/configuration&gt;</span>

</code></pre></div><p>可以在oozie-env.sh中进行参数修改，比如修改端口号，默认端口号为11000</p>
<h3 id="5-创建扩展目录">5 创建扩展目录</h3>
<p>oozie根目录创建libext文件夹，复制mysql的driver压缩包到libext文件夹中,也可以做一个软连接(libext是lib的扩展目录，好多软件都有)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># cd /opt/oozie-4.1.0-cdh5.14.2/</span>
<span style="color:#75715e"># mkdir libext</span>
<span style="color:#75715e"># cp /software/mysql-connector-java-5.1.31.jar ./libext/</span>

</code></pre></div><h3 id="6-创建oozie需要的表">6 创建oozie需要的表</h3>
<p>创建oozie需要的表结构，命令：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ooziedb.sh create -sqlfile oozie.sql -run

</code></pre></div><p>使用mysql客户端查看是否生成oozie的数据库和表</p>
<p><img src="https://i.loli.net/2020/05/07/346Jc1na9Yr5mRp.png" alt="image-20200507110036916"></p>
<h3 id="7-设置hadoop代理用户">7 设置hadoop代理用户</h3>
<p>设置hadoop代理用户。<code>hadoop.proxyuser.root.hosts&amp;hadoop.proxyuser.root.groups</code>启动或者重新启动HDFS+YARN</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"># vi /opt/hadoop-2.6.0-cdh5.14.2/etc/hadoop/core-site.xml
添加如下配置
-----------------------------------------------------
<span style="color:#f92672">&lt;property&gt;</span>
    <span style="color:#f92672">&lt;name&gt;</span>hadoop.proxyuser.root.hosts<span style="color:#f92672">&lt;/name&gt;</span>
    <span style="color:#f92672">&lt;value&gt;</span>*<span style="color:#f92672">&lt;/value&gt;</span>
<span style="color:#f92672">&lt;/property&gt;</span>
<span style="color:#f92672">&lt;property&gt;</span>
    <span style="color:#f92672">&lt;name&gt;</span>hadoop.proxyuser.root.groups<span style="color:#f92672">&lt;/name&gt;</span>
    <span style="color:#f92672">&lt;value&gt;</span>*<span style="color:#f92672">&lt;/value&gt;</span>
<span style="color:#f92672">&lt;/property&gt;</span>

</code></pre></div><h3 id="8-在hdfs上创建公用文件夹">8 在hdfs上创建公用文件夹</h3>
<h4 id="81-执行命令">8.1 执行命令</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># oozie-setup.sh sharelib create -fs hdfs://singleNode:9000 -locallib /opt/oozie-4.1.0-cdh5.14.2/oozie-sharelib-4.1.0-cdh5.14.2-yarn.tar.gz</span>

</code></pre></div><h4 id="82-创建war文件">8.2 创建war文件</h4>
<p><strong>需安装unzip和zip</strong> <code>yum-y install unzip;yum -y install zip</code>,   执行</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># addtowar.sh -inputwar $OOZIE_HOME/oozie.war -outputwar $OOZIE_HOME/oozie-server/webapps/oozie.war -hadoop 2.6.0 $HADOOP_HOME -jars $OOZIE_HOME/libext/mysql-connector-java-5.1.31.jar -extjs /software/ext-2.2.zip</span>

</code></pre></div><p>或者将hadoop相关包，mysql相关包和ext压缩包放到libext文件夹中，运行<code>oozie-setup.sh prepare-war</code>也可以创建war文件</p>
<h3 id="9-启动oozie">9 启动oozie</h3>
<p>运行：<strong>oozied.sh run</strong> 或者 <strong>oozied.sh start</strong>(前者在前端运行，后者在后台运行)</p>
<pre><code>oozied.sh start

</code></pre><p>jps 看见bootstrap说明oozie启动起来了###使用 oozied.sh stop 停止服务</p>
<p><img src="https://i.loli.net/2020/05/07/QDtodcmfWbJHxpO.png" alt="image-20200507110048861"></p>
<p>查看web界面&amp;查看状态<code>oozie admin -oozie http://singleNode:11000/oozie -status </code>##显示normal属于正常</p>
<p><img src="https://i.loli.net/2020/05/07/W6Z3hRFAEVSMGDI.png" alt="image-20200507110054760"></p>
<p>web页面查看地址：http://singleNode:11000/oozie</p>
<p><img src="https://i.loli.net/2020/05/07/XesgSypDCYvUcRb.png" alt="image-20200507110108176"></p>
<h2 id="oozie使用">Oozie使用</h2>
<h3 id="1-示例一">1 示例一</h3>
<h4 id="11-编写jobproperties">1.1 编写job.properties</h4>
<pre><code class="language-properties" data-lang="properties">nameNode=hdfs://singleNode:9000
jobTracker=singleNode:8032
queueName=default
examplesRoot=myoozie

oozie.wf.application.path=${nameNode}/user/${examplesRoot}/fs/workflow.xml

</code></pre><h4 id="12-编写workflowxml">1.2 编写workflow.xml</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;workflow-app</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;uri:oozie:workflow:0.4&#34;</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;fs&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;start</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;fs-delete&#34;</span> <span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;fs-delete&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;fs&gt;</span>
            <span style="color:#f92672">&lt;delete</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;${nameNode}/oozie.txt&#34;</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;delete</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;${nameNode}/bin&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;/fs&gt;</span>
        <span style="color:#f92672">&lt;ok</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;fs-mkdir&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;error</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;fail&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/action&gt;</span>


    <span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;fs-mkdir&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;fs&gt;</span>
            <span style="color:#f92672">&lt;mkdir</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;${nameNode}/kgc&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;/fs&gt;</span>
        <span style="color:#f92672">&lt;ok</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;fs-move&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;error</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;fail&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/action&gt;</span>

    <span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;fs-move&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;fs&gt;</span>
            <span style="color:#f92672">&lt;move</span> <span style="color:#a6e22e">source=</span><span style="color:#e6db74">&#34;${nameNode}/123&#34;</span> <span style="color:#a6e22e">target=</span><span style="color:#e6db74">&#34;${nameNode}/456&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;/fs&gt;</span>
        <span style="color:#f92672">&lt;ok</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;end&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;error</span> <span style="color:#a6e22e">to=</span><span style="color:#e6db74">&#34;fail&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/action&gt;</span>

    <span style="color:#f92672">&lt;kill</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;fail&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;message&gt;</span>fs action failed, error message[${wf:errorMessage(wf:lastErrorNode())}]<span style="color:#f92672">&lt;/message&gt;</span>
    <span style="color:#f92672">&lt;/kill&gt;</span>

    <span style="color:#f92672">&lt;end</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;end&#34;</span> <span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/workflow-app&gt;</span>

</code></pre></div><h4 id="13-在hdfs创建目录">1.3 在HDFS创建目录</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># hdfs dfs -put /etc/passwd /oozie.txt</span>
<span style="color:#75715e"># hdfs dfs -mkdir /bin</span>
<span style="color:#75715e"># hdfs dfs -touchz /123</span>
<span style="color:#75715e"># hdfs dfs -mkdir /456</span>

</code></pre></div><h4 id="14-上传workflowxml">1.4 上传workflow.xml</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># hdfs dfs -mkdir -p /user/myoozie/fs</span>
<span style="color:#75715e"># hdfs dfs -put workflow.xml /user/myoozie/fs</span>

</code></pre></div><h4 id="15-开启日志聚集">1.5 开启日志聚集</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># mr-jobhistory-daemon.sh start historyserver</span>

</code></pre></div><h4 id="16-检查workflow是否有效">1.6 检查workflow是否有效</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># oozie validate workflow.xml</span>
如果报如下异常，需要导入OOzie的url
------------------------------
java.lang.IllegalArgumentException: Oozie URL is not available neither in command option or in the environment
        at org.apache.oozie.cli.OozieCLI.getOozieUrl<span style="color:#f92672">(</span>OozieCLI.java:702<span style="color:#f92672">)</span>
        at org.apache.oozie.cli.OozieCLI.createXOozieClient<span style="color:#f92672">(</span>OozieCLI.java:907<span style="color:#f92672">)</span>
        at org.apache.oozie.cli.OozieCLI.validateCommand<span style="color:#f92672">(</span>OozieCLI.java:1951<span style="color:#f92672">)</span>
        at org.apache.oozie.cli.OozieCLI.processCommand<span style="color:#f92672">(</span>OozieCLI.java:676<span style="color:#f92672">)</span>
        at org.apache.oozie.cli.OozieCLI.run<span style="color:#f92672">(</span>OozieCLI.java:617<span style="color:#f92672">)</span>
        at org.apache.oozie.cli.OozieCLI.main<span style="color:#f92672">(</span>OozieCLI.java:218<span style="color:#f92672">)</span>
Oozie URL is not available neither in command option or in the environment
---------------------------------------
<span style="color:#75715e"># export OOZIE_URL=http://singleNode:11000/oozie</span>

</code></pre></div><h4 id="17-执行程序">1.7 执行程序</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># oozie job -oozie http://singleNode:11000/oozie -config job.properties -run</span>

</code></pre></div><h4 id="18-查看web界面">1.8 查看web界面</h4>
<p><img src="https://i.loli.net/2020/05/07/yEcsGfTPYz84Dnx.png" alt="image-20200507110116505"></p>
<h2 id="七-常见问题">七 常见问题</h2>
<h3 id="sandbox安装oozie扩展">sandbox安装oozie扩展</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">wget http://public-repo-1.hortonworks.com/HDP-UTILS-GPL-1.1.0.22/repos/centos7-ppc/extjs/extjs-2.2-1.noarch.rpm

rpm -ivh extjs-2.2-1.noarch.rpm

rm /usr/hdp/current/oozie-server/.prepare_war_cmd

<span style="color:#75715e"># 重启Oozie</span>

</code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
